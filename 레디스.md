## redis ttl(Time To Live)
레디스 데이터 구조에서 저장된 데이터가 유효한 시간 또는 만료 시간을 설정하는 기능이다. 
ttl을 사용하면 특정 키에 대해 자동으로 만료시간을 설정할 수 있어, 시간이 지나면 해당 키가 Redis에서 자동으로 삭제된다. 
### 주요 개념 
1. ttl 설정 
  - `EXPIRE key seconds`: 주어진 key에 대해 ttl을 초단위로 설정한다.
  - `PEXPIRE key milliseconds`: TTL을 밀리초 단위로 설정한다.
2. ttl 조회
  - `TTL key`: 주어진 키의 남은 TTL초 단위를 반환한다. -1이면 ttl이 0이거나, 키가 존재하지 않는다. -2면 key가 존재하지 않는다. (?) 
  - `PTTL key`:  TTL를 밀리초 단위로 반환한다. 
3. ttl 제거
  - `PERSIST key`: TTL을 제거하고 키를 영구적으로 유지한다. 키는 만료되지 않고, 삭제되기 전까지 유지된다. 
4. 키 만료 방법 
  - 시간 기반 만료: 특정 시간 이후에 만료된다.
  - 접근 기반 만료: 키가 특정 시간 동안 사용되지 않으면 만료하도록 설정할 수 있다.
5. 만료 이벤트
  - Redis는 키가 만료되면 삭제한다. Redis 서버가 키를 액세스할 때마다 확인하고, 만료된 키를 제거한다.
## 레디스 분산락
분산락은 여러 서버나 인스턴스에서 동시 접근이 필요한 자원에 대해 동기화를 유지하기 위한 방법이다. 
### 레디스로 분산락 구현하기 
1. 락 획득: 특정 키를 redis에 설정하여 락을 획득한다.
2. 락 만료 시간 설정: 락을 설정할 때, 만료 시간을 지정하여 락이 장기간 유지되지 않도록 한다. 락이 해제되지 않는 상황에서 시스템이 자동으로 락을 해제할 수 있게 보장한다.
3. 락 해제: 작업이 끝난 후 락을 해제하여 다른 서버나 인스턴스가 해당 자원에 접근할 수 있도록 한다. 
### RedLock 알고리즘 
redis 인스턴스에 락을 걸어 분산 시스템에서도 신뢰성을 높이는 방법이다. Redlock은 여러 Redis 인스턴스에 락을 결고, 다수의 인스턴스에서 동의할 때 락을 획득한 것으로 간주한다. 
### 분산락 알고리즘 
1. Redisson: 고급 분산락을 지원하는 자바 라이브러리. 분산 컬랙션, 분산 캐시 등 다양한 기능을 제공함. 
2. Jedis: Redis의 자바 클라이언트 라이브러리로, 기본적인 분산락 구현을 지원한다. Lua 스크립트와 SET 명령어를 이용한 간단한 락 구현이 가능하다. 
### Jedis를 이용한 분산락 
```java
public class RedisDistributedLock {
  private static final String LOCK_KEY = "lock:key";
  private static final String LOCK_VALUE = "lock:value";
  private static final int LOCK_EXPIRE = 10000;

  private JedisPool jedisPool;

  public RedisDistributedLock(String redisHost, int redisPort) {
      JedisPoolConfig poolConfig = new JedisPoolConfig();
      jedisPool = new JedisPool(poolConfig, redisHost, redisPort);
  }

  public boolean aquireLock() {
    try(Jedis jedis = jedisPool.getResource()) {
      String result = jedis.set(LOCK_KEY, LOCK_VALUE, "NX", "PX", LOCK_EXPIRE);
      return "OK".equals(result);
    }
  }

  public void releaseLock() {
        try (Jedis jedis = jedisPool.getResource()) {
            // Ensure that the lock is released only if it was held by this instance
            String value = jedis.get(LOCK_KEY);
            if (LOCK_VALUE.equals(value)) {
                jedis.del(LOCK_KEY);
            }
        }
  }
  public static vaid main(String[] args) {
      RedisDistributedLock lock = new RedisDistributedLock("localhost", 6379); 
      if(lock.acquireLock()) {
          try {
              System.out.println("Lock acquired. Performing critical section.");
          } finally {
              lock.releaseLock();
              System.out.println("Lock released.");
          }
      } else {
          System.out.println("Failed to acquire lock.");
      }
  }
}
```
