## 카프카 
### 카프카 Offset
특정 메세지가 특정 파티션에서 어디에 위치하는지를 나타내는 지표. 
#### 오프셋의 특징
1. 고유성: 각 메세지는 해당 파티션 낸에서 유일한 offset을 가지며, 이는 파티션 내에서 메세지의 순서를 나타낸다.
2. 커밋: 컨슈머가 메세지를 처리한 후, 커밋을 통해 마지막으로 읽은 offset을 저장한다. offset은 컨슈머 그룹의 진행 상태를 추적하는데 사용된다. 컨슈머가 재시작되거나 장애가 발생하면 커밋된 offset을 기준으로 처리 상태를 복원한다.
3. 상태 관리: 여러 컨슈머 그룹이 독립적으로 offset을 관리한다. 동일한 파티션의 메세지를 여러 그룹이 별도로 처리할 수 있다.
4. offset 저장소: 카프카는 내부적으로 `__consumer_offsets`에 오프셋 정보를 저장한다. 이 토픽은 컨슈머 그룹의 오프셋 상태를 유지하며, 컨슈머가 커밋한 오프셋을 기록한다.
5. 복구와 리플레이: 저장된 offset을 통해 메세지를 복구하거나 리플레이 할 수 있다.
#### 오프셋 관리
1. 자동 오프셋 커밋: 카프카가 주기적으로 오프셋을 커밋한다. 메세지 처리 중 오류가 발생하거나 consumer가 비정상 종료되면 일부 메세지가 중복처리 되거나 손실될 수 있다.
   ```
   enable.auto.commit = true
   auto.commit.interval.ms = 커밋 주기
   ```  
2. 수동 오프셋 커밋: 메세지를 성공적으로 커밋한 후 명시적으로 오프셋을 커밋한다. (코드에서 직접 관리)
   ```
   commitSync(): 동기식으로 오프셋을 커밋한다. 커밋이 완료될 때까지 멈춘다.
   commitAync(): 비동기식으로 오프셋을 커밋한다. 커밋 요청을 보내고 응답을 기다리지 않는다. 
   ``` 
3. 오프셋 리셋: 스트림의 처음 위치로 돌아가려고 할 때 사용한다.
   콘솔 커멘트로 리셋하기: Kafka의 kafka-consumer-groups.sh 스크립트를 사용
   ```
   kafka-consumer-groups.sh --bootstrap-server -localhost:9002 --group my-group --topic my-topic --reset-offsets --to-earliest --execute
   ```
   프로그램 적으로 리셋하기: seekToBeginning() 또는 seekToEnd()
   ```
   consumer.seekToBeginning(consumer.assignment());
   consumer.seekToEnd(consumer.assignment());
   ```
4. 커스텀 오프셋 관리
   서비스에서 직접 오프셋을 수동으로 조정하거나, 외부 데이터베이스에 오프셋 정보를 저장하고 관리할 수 있다.
   외부 데이터베이스의 오프셋 정보를 읽어와 직접 consumer에 오프셋을 지정한다. (seek 메소드 사용)

