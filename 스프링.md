## 스프링

### 스프링 Interceptor
스프링 프레임워크의, 스프링 MVC에서 HTTP 요청과 응답을 가로채어 처리하는 기능
#### 주요기능 
1. Controller가 요청을 받기 전에 가로채어 처리할 수 있다.
2. Controller 응답 후 뷰 랜더링 전에 응답을 가로채어 처리할 수 있다.
3. 뷰 렌더링 후 가로채어 처리할 수 있다.
#### 구현 방법
HandlerInterceptor 인터페이스를 구현하면 된다. HandlerInterceptor는 아래 메소드를 포함한다. 
1. preHandle: Controller가 요청을 처리하기 전에 호출된다.
```java
boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception;
```
2. postHandle: 요청을 처리한 후 뷰가 렌더링 되기 전에 호출된다.
```java
void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception;
```
3. afterCompletion: 뷰 렌더링이 완료된 후 호출된다.
```java
void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception;
```   
#### 인터셉터 추가하기 
```java
@Configuration
public class WebConfig implement WebMvcConfigurer {
  private final MyInterceptor myInterceptor;
  public WebConfig(MyInterceptor myInterceptor) {
        this.myInterceptor = myInterceptor;
    }

   @Override
   public void addInterceptors(InterceptorRegistry registry) {
       registry.addInterceptor(myInterceptor);
   }
}
```
#### 사용 예시 
1. 보안: 사용자 인증 및 권한 검사를 요청 전에 수행하는 경우
2. 로그 기록: 요청 및 응답에 대한 정보를 기록하는 경우
3. 데이터 변환: 요청이나 응답 데이터를 수정하는 경우
4. 성능: 캐싱을 구현하거나 요청 처리를 최적화하는 경우

### 스프링 TransactionSynchronization 
스프링에서 트랜잭션의 상태에 따라 특정 작업을 수행할 수 있도록 해주는 인터페이스. 
#### 주요 기능
1. beforeCommit(boolean readOnly): 트랜잭션이 commit 되기 전에 호출된다.
  - `readOnly` 플래그는 트랜잭션이 읽기 전용인지 여부를 나타낸다.
  - 트랜잭션이 커밋되기 전에 검증 작업이나 준비 작업을 수행할 때 사용한다.
2. afterCommit(): 트랜잭션이 성공적으로 commit된 후 호출된다.
  - 트랜잭션이 완료된 이후에 실행해야 하는 작업(외부 시스템에 알림을 보내거나, 캐시를 업데이트 하는 작업 등)을 수행할 때 유용하다.
3. beforeCompletion(): 트랜잭션이 commit되거나 rollback되기 전에 호출된다.
4. afterCompletion(int status): 트랜잭션이 commit되거나 rollack된 후 호출된다.
  - `status` 플래그는 트랜잭션이 commit됐는지 rollback됐는지를 나타낸다.
#### 구현 방법
TransactionSynchronization을 구현한다. 
```java
public class MyTransactionSynchronization implements TransactionSynchronization {
  @Override
  public void beforeCommit(boolean readOnly) {
    if(!readOnly) {}
  }
  @Override
  public void afterCommit() {

  }

  @Override
  public void beforeCompletion() {
  }

  @Override
  public void afterCompletion(int status) {
      if(status == STATUS_COMPLETED) {} else if (status == STATUS_ROLLED_BACK){}
  }
}
```
TransactionSynchronizationMananger로 등록할 수 있다. 
```java
 TransactionSynchronizationManager.registerSynchronization(new MyTransactionSynchronization());
```
